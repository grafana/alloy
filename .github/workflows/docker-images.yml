name: Check Docker images

on:
  pull_request: {}
    #  pull_request:
    #    paths:
    #      - Dockerfile
    #      - Dockerfile.windows
    #      - Makefile
    #      - 'tools/make/*'

jobs:
  # NOTE(rfratto): We only test building the Docker images for the host
  # platform, but we're really only looking for issues that are
  # architecture-independent.
  linux:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - name: Build image
        run: |
          docker build -t alloy-test:latest -f Dockerfile .

  windows:
    runs-on: windows-2019
    steps:
      - uses: actions/checkout@v4
      - name: Build image
        run: |
          docker build -t alloy-test:latest -f Dockerfile.windows .

  windows-test:
    runs-on: windows-2019
    steps:
      - uses: actions/checkout@v4
      - uses: mr-smithers-excellent/docker-build-push@v6
        with:
          registry: docker.io
          image: grafana/alloy
          tags: latest
          dockerfile: ./Dockerfile.windows
          pushImage: false
