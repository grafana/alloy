# Directory Provider

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [alpha]   |
| Distributions | []        |

[alpha]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#alpha
<!-- end autogenerated section -->

## Overview

The Directory Provider watches a directory for YAML configuration files and provides merged configuration to the Collector. When files are added, modified, or deleted in the directory, the provider signals the Collector to reload its configuration.

## Features

- Watches a directory for `*.yaml` and `*.yml` files
- Automatically merges all YAML files in alphabetical order
- Supports hot-reloading when files change
- 5-second debounce to prevent rapid reloads during bulk updates
- Compatible with Kubernetes ConfigMap volume mounts

## Usage

The scheme for this provider is `dirwatch`. Usage looks like the following:

```text
dirwatch:/path/to/config/dir
```

### Example

Given a directory `/etc/otelcol/config.d/` with the following files:

```
/etc/otelcol/config.d/
├── 01-receivers.yaml
├── 02-processors.yaml
└── 03-exporters.yaml
```

Start the collector with:

```bash
otelcol --config=dirwatch:/etc/otelcol/config.d/
```

The provider will:
1. Read all `*.yaml` and `*.yml` files in alphabetical order
2. Merge them into a single configuration
3. Watch for changes and trigger config reload when files are modified

### Kubernetes ConfigMap Example

This provider works well with Kubernetes ConfigMaps mounted as volumes:

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: otelcol-config
data:
  01-base.yaml: |
    receivers:
      otlp:
        protocols:
          grpc:
    exporters:
      debug:
  02-pipelines.yaml: |
    service:
      pipelines:
        traces:
          receivers: [otlp]
          exporters: [debug]
---
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      containers:
        - name: otelcol
          args:
            - --config=dirwatch:/etc/otelcol/config.d/
          volumeMounts:
            - name: config
              mountPath: /etc/otelcol/config.d/
      volumes:
        - name: config
          configMap:
            name: otelcol-config
```

## Behavior

### File Filtering
- Only files with `.yaml` or `.yml` extensions are processed
- Hidden files (starting with `.`) are ignored
- Subdirectories are not watched

### Merge Order

Files are merged in **alphabetical order**. Later files override earlier ones for conflicting keys.

#### Why Alphabetical Order Matters

Alphabetical ordering is critical for **deterministic and predictable** configuration merging:

1. **Reproducibility**: The same set of files always produces the same merged configuration, regardless of filesystem implementation details or the order files were created.

2. **Predictable Overrides**: When files have overlapping configuration keys, you can reliably control which values take precedence by naming files appropriately (e.g., `01-base.yaml`, `02-overrides.yaml`, `99-final.yaml`).

3. **Cross-Platform Consistency**: Different operating systems and filesystems may return directory entries in different orders. Alphabetical sorting ensures consistent behavior across Linux, macOS, and Windows.

4. **Debugging**: When troubleshooting configuration issues, alphabetical order makes it easy to understand which file's values will "win" for any given key.

#### Naming Convention

We recommend using numeric prefixes to explicitly control merge order:

```
config.d/
├── 00-defaults.yaml      # Base configuration, loaded first
├── 10-receivers.yaml     # Component definitions
├── 20-processors.yaml
├── 30-exporters.yaml
├── 50-pipelines.yaml     # Service configuration
└── 99-overrides.yaml     # Environment-specific overrides, loaded last
```

Files with higher numeric prefixes override values from files with lower prefixes.

### Error Handling
If any YAML file is malformed, the entire configuration load fails. This ensures you're always running with a valid, complete configuration.

### Debouncing
To prevent rapid reloads during bulk updates (like `kubectl apply`), changes are debounced with a 5-second window. Multiple file changes within this window result in a single reload.

