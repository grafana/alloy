This test verifies id field behavior with invalid/missing field names and non-object collection items.

-- main.alloy --
foreach "testForeach" {
  collection = ["plain-string",{"namespace" = "prod"},42]
  var = "item"
  id = "namespace"
  enable_metrics = true

  template {
    testcomponents.pulse "pt" {
      max = 10
      frequency = "10ms"
      forward_to = [testcomponents.summation_receiver.sum.receiver]
    }
  }
}

testcomponents.summation_receiver "sum" {
}

-- expected_metrics.prom --

# HELP alloy_component_controller_evaluating Tracks if the controller is currently in the middle of a graph evaluation
# TYPE alloy_component_controller_evaluating gauge
alloy_component_controller_evaluating{controller_id="",controller_path="/"} 0
alloy_component_controller_evaluating{controller_id="foreach_plain_string_1",controller_path="/foreach.testForeach"} 0
alloy_component_controller_evaluating{controller_id="foreach_prod_1",controller_path="/foreach.testForeach"} 0
alloy_component_controller_evaluating{controller_id="foreach_42_1",controller_path="/foreach.testForeach"} 0
# HELP alloy_component_controller_running_components Total number of running components.
# TYPE alloy_component_controller_running_components gauge
alloy_component_controller_running_components{controller_id="",controller_path="/",health_type="healthy"} 2
alloy_component_controller_running_components{controller_id="foreach_42_1",controller_path="/foreach.testForeach",health_type="healthy"} 1
alloy_component_controller_running_components{controller_id="foreach_plain_string_1",controller_path="/foreach.testForeach",health_type="healthy"} 1
alloy_component_controller_running_components{controller_id="foreach_prod_1",controller_path="/foreach.testForeach",health_type="healthy"} 1
# HELP pulse_count 
# TYPE pulse_count counter
pulse_count{component_id="testcomponents.pulse.pt",component_path="/foreach.testForeach/foreach_42_1"} 5
pulse_count{component_id="testcomponents.pulse.pt",component_path="/foreach.testForeach/foreach_plain_string_1"} 5
pulse_count{component_id="testcomponents.pulse.pt",component_path="/foreach.testForeach/foreach_prod_1"} 5


-- expected_duration_metrics.prom --

8