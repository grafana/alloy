pyroscope.receive_http "proxy" {
  http {
    listen_address = "0.0.0.0"
    listen_port = 4041
    conn_limit = 65536
  }
  forward_to = [pyroscope.write.endpoint.receiver]
}

pyroscope.write "endpoint" {
  endpoint {
    //url = "https://profiles-prod-008.grafana.net"
    url = "http://localhost:4040/"

    basic_auth {
      username = "1351761"
      password = "glc_..."
    }
    

    remote_timeout = "10s"

    max_backoff_retries=-1
  }
}


logging {
  level = "debug"
  format = "logfmt"
  write_to = [
    loki.write.korniltsev.receiver,
    // loki.write.private.receiver,
  ]
}

loki.write "korniltsev" {
    external_labels = {
        "debug_deadline" = "true",
    }
    endpoint {
            url = "https://logs-prod-021.grafana.net/loki/api/v1/push"
            basic_auth {
                username = "1309555"
                password = "glc_"
            }
            batch_size = "1MiB"
            batch_wait = "10s" // todo remove
            // batch_wait = "60s"
        }
}

loki.write "private" {
    external_labels = {
        "debug_deadline" = "true",
    }
    endpoint {
            // obtain these from grafana.com stack from "send logs" page.
            url = "TODO"
            basic_auth {
                username = "TODO"
                password = "glc_TODO"
            }
            batch_size = "1MiB"
            batch_wait = "60s"
        }
}
